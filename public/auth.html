<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Trading Diary - Login</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>Trading Diary - Login</h1>
  <form id="authForm">
    <label>Google Client ID: <input type="text" id="clientId" required></label><br>
    <label>Google API Key: <input type="text" id="apiKey" required></label><br>
    <button type="submit">Initialize Login</button>
  </form>
  <div id="signinContainer" style="display:none;">
    <div id="g_id_onload"
         data-client_id=""
         data-callback="handleCredentialResponse"
         data-auto_prompt="false"
         data-scope="https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/spreadsheets">
    </div>
    <div class="g_id_signin" data-type="standard" data-text="signin_with"></div>
  </div>
  <script>
    let clientId, apiKey;

    function handleCredentialResponse(response) {
      localStorage.setItem('id_token', response.credential);
      localStorage.setItem('client_id', clientId);
      localStorage.setItem('api_key', apiKey);
      window.location.href = 'index.html';
    }

    function loadGSIScript(clientId) {
      const script = document.createElement('script');
      script.src = 'https://accounts.google.com/gsi/client';
      script.async = true;
      script.defer = true;
      script.onload = () => {
        document.querySelector('#g_id_onload').setAttribute('data-client_id', clientId);
        document.getElementById('signinContainer').style.display = 'block';
      };
      document.head.appendChild(script);
    }

    document.getElementById('authForm').onsubmit = (e) => {
      e.preventDefault();
      clientId = document.getElementById('clientId').value.trim();
      apiKey = document.getElementById('apiKey').value.trim();
      if (clientId && apiKey) {
        loadGSIScript(clientId);
      } else {
        alert('Please enter valid Client ID and API Key');
      }
    };
  </script>
</body>
</html>